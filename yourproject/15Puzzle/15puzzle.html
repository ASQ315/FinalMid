<!DOCTYPE html>
<html>
<head>
 <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Ubuntu:wght@300&display=swap" rel="stylesheet">
    
<title>15 Puzzle Game</title>

<link rel="stylesheet" type = "text/css" href="stylesheet15puzzle.css">
    </head>

</head>
<body>

<h1>15 Puzzle Game</h1>
<div id="puzzle"></div>

<script>
const puzzle = document.getElementById('puzzle');
let tiles = [...Array(15).keys()].map(n => n + 1).concat(null); // 1-15 + empty

function drawPuzzle() {
    puzzle.innerHTML = '';
    tiles.forEach(tile => {
        const div = document.createElement('div');
        if (tile === null) {
            div.classList.add('empty');
        } else {
            div.textContent = tile;
            div.addEventListener('click', () => moveTile(tile));
        }
        puzzle.appendChild(div);
    });
}

function moveTile(num) {
    const idx = tiles.indexOf(num);
    const emptyIdx = tiles.indexOf(null);
    const validMoves = getAdjacent(emptyIdx);
    if (validMoves.includes(idx)) {
        [tiles[idx], tiles[emptyIdx]] = [tiles[emptyIdx], tiles[idx]];
        drawPuzzle();
        checkSolved();
    }
}

function getAdjacent(index) {
    const adj = [];
    const row = Math.floor(index / 4);
    const col = index % 4;
    if (row > 0) adj.push(index - 4); // up
    if (row < 3) adj.push(index + 4); // down
    if (col > 0) adj.push(index - 1); // left
    if (col < 3) adj.push(index + 1); // right
    return adj;
}

function shufflePuzzle() {
    do {
        tiles = tiles
            .map(value => ({ value, sort: Math.random() }))
            .sort((a, b) => a.sort - b.sort)
            .map(({ value }) => value);
    } while (!isSolvable(tiles) || checkSolved(true));
}

function isSolvable(arr) {
    const list = arr.filter(n => n !== null);
    let inversions = 0;
    for (let i = 0; i < list.length; i++) {
        for (let j = i + 1; j < list.length; j++) {
            if (list[i] > list[j]) inversions++;
        }
    }
    const emptyRowFromBottom = 4 - Math.floor(arr.indexOf(null) / 4);
    if (emptyRowFromBottom % 2 === 0) {
        return inversions % 2 === 1;
    } else {
        return inversions % 2 === 0;
    }
}

function checkSolved(silent = false) {
    const solved = tiles.slice(0, 15).every((val, idx) => val === idx + 1);
    if (solved && !silent) {
        setTimeout(() => alert('Congratulations! You solved the puzzle!'), 100);
    }
    return solved;
}

// Initialize
shufflePuzzle();
drawPuzzle();
</script>
</body>
</html>
